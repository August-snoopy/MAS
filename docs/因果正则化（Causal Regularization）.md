### 因果正则化

受因果归一化流（Causal Normalizing Flows, CNF）方法启发，我们提出了一种结合**先验知识与降维**操作的**因果正则化策略**。此策略旨在生成符合生物动力学特征的因果图。我们使用自回归归一化流（Autoregressive Normalizing Flow, ANF）和结构因果模型（SCM）相结合的方法，增强生成因果图的准确性和稳定性。

#### 方法概述

**先验图的构建：** 先验图的生成基于生物动力学特征，我们引入了一个虚拟节点用于表示当前动作的类别标签。虚拟节点初始时均匀地全连接于每个关节节点，保证在因果发现过程中，不仅可以识别关节节点之间的因果关系，也能揭示关节节点与虚拟节点之间的因果联系。

注意，初始先验图构建为无向图，我们期望在因果发现中确认节点顺序。

![image-20240613152558641](C:\Users\zeyan\OneDrive\Photos\Picture1.png)

**因果图优化：** 为了使生成的因果图更接近先验图，我们采用ANF和L1正则化与结构因果模型（SCM）结合。通过这种方法，我们可以在SCM生成的因果图中嵌入先验知识，同时减小图的复杂度。具体而言，更改ANF的最大观测似然（MLE），添加L1项：
$$
\max_{\theta} \frac{1}{N} \sum_{n=1}^N \left[ \log p (T_\theta (x_n)) + \log|\det(\nabla_x T_\theta (x_n))| \right]+\lambda \sum|x_n| ，
$$
ANF有助于调节因果图中的边权重，使其成为0，从而达到了降维的效果。

采用L1正则化而非L2正则化的原因是，我们期望通过最小化损失函数来达到降维的效果，若使用L2正则化同时采用阈值进行过滤则失去了自适应性。

可以修改$\lambda$的值来获取多种尺度的因果图。

#### 数据与训练

**输入数据：** 因果图的输入数据为长时间序列数据，这些数据包含多个动作序列，并且保留时间连续性。例如，一个样本可以是时长为20秒（500帧）的引体向上动作，其标签包括“向上举臂”、“向下拉臂”等细化的动作描述。

**因果图选择：** 为了提升因果图的鲁棒性，我们基于分数筛选多个因果图，并确保这些图之间存在较大的差异。筛选过程中使用的分数可以包括残差、均方误差（MSE）等指标，这些指标用于评估训练好的因果图与先验图之间的差异。**如果这些值在可接受的范围内，说明生成的因果图具有较高的可信度。**  ==什么叫可接受的范围==

![img](https://pic2.zhimg.com/80/v2-82197e7ce8fcd63bb801800e671e5789_1440w.webp)

**多尺度融合：** 通过训练生成多种因果图，我们构建了一个多尺度的图集。在模型融合阶段，采用多尺度图进行综合处理，最终形成一个多尺度时空图神经网络（Multi-scale Spatiotemporal Graph Neural Network, MSGNN），这进一步增强了模型对复杂时间序列数据的处理能力。同时融合注意力机制，来发掘不同子图的权重分数。使用权重分数证明子图有效。

![img](https://pic3.zhimg.com/80/v2-4e586f73118cc51a9163605734da03be_1440w.webp)

**降维：**使用注意力加权后的单个子图，来进行单尺度预测，观测单尺度与多尺度下的效果如何，证明能够成功降维。从而可以提出一个系列网络。单尺度用于轻量化设计，多尺度用于准确性设计。

小技巧：

- 离散余弦变换(Guo et al., 2023)
- 统一图卷积(Wang et al., 2024, AAAI)
- 超宽带测距(Armani et al., 2024)
- 运动学特征提取(Ponton et al., 2023) (Jiang et al., 2022)
- 组合图归一化(Yao et al., 2023)